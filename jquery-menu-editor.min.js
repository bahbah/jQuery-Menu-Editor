function MenuEditor(t,e){var n=$("#"+t).data("level","0"),s={labelEdit:'<i class="fas fa-edit clickable"></i>',labelRemove:'<i class="fas fa-trash-alt clickable"></i>',textConfirmDelete:"This item will be deleted. Are you sure?",iconPicker:{cols:4,rows:4,footer:!1,iconset:"fontawesome5"},maxLevel:-1,listOptions:{hintCss:{border:"1px dashed #13981D"},opener:{as:"html",close:'<i class="fas fa-minus"></i>',open:'<i class="fas fa-plus"></i>',openerCss:{"margin-right":"10px",float:"none"},openerClass:"btn btn-success btn-sm"},placeholderCss:{"background-color":"gray"},ignoreClass:"clickable",listsClass:"pl-0",listsCss:{"padding-top":"10px"},complete:function(t){return MenuEditor.updateButtons(n),n.updateLevels(0),!0},isAllowed:function(t,e,n){return m(t,n)}}};$.extend(!0,s,e);var i={},a=null,l=!0,r=null,o=null,d=s.iconPicker,c=(e=s.listOptions,$("#"+t+"_icon").iconpicker(d));n.sortableLists(s.listOptions),MutationObserver=window.MutationObserver||window.WebKitMutationObserver;var u=new MutationObserver(function(t){$.each(t,function(t,e){if(1==e.addedNodes.length){var n=$(e.target),s=$(e.addedNodes);s.hasClass("sortableListsOpener")&&!s.is(":first-child")&&n.prepend(s)}})}),p={subtree:!1,attributes:!1,childList:!0};function h(){r[0].reset(),(c=c.iconpicker(d)).iconpicker("setIcon","empty"),o.attr("disabled",!0),a=null}function f(t){return $("<a>").addClass(t.classCss).addClass("clickable").attr("href","#").html(t.text)}function v(){var t=$("<div>").addClass("btn-group float-right"),e=f({classCss:"btn btn-primary btn-sm btnEdit",text:s.labelEdit}),n=f({classCss:"btn btn-danger btn-sm btnRemove",text:s.labelRemove}),i=f({classCss:"btn btn-secondary btn-sm btnUp btnMove",text:'<i class="fas fa-angle-up clickable"></i>'}),a=f({classCss:"btn btn-secondary btn-sm btnDown btnMove",text:'<i class="fas fa-angle-down clickable"></i>'}),l=f({classCss:"btn btn-secondary btn-sm btnOut btnMove",text:'<i class="fas fa-level-down-alt clickable"></i>'}),r=f({classCss:"btn btn-secondary btn-sm btnIn btnMove",text:'<i class="fas fa-level-up-alt clickable"></i>'});return t.append(i).append(a).append(r).append(l).append(e).append(n),t}function b(t){$("<span>").addClass("sortableListsOpener "+e.opener.openerClass).css(e.opener.openerCss).on("mousedown touchstart",function(t){var n=$(this).closest("li");return n.hasClass("sortableListsClosed")?n.iconOpen(e):n.iconClose(e),!1}).prependTo(t.children("div").first()),t.hasClass("sortableListsOpen")?t.iconOpen(e):t.iconClose(e)}function m(t,e){if(s.maxLevel<0)return!0;var n=0,i=t.find("ul").length;return n=0==e.length?0:parseInt(e.parent().data("level"))+1,console.log(n+i),n+i<=s.maxLevel}c.on("change",function(t){r.find("[name=icon]").val(t.icon)}),$(document).on("click",".btnRemove",function(e){if(e.preventDefault(),confirm(s.textConfirmDelete)){var i=$(this).closest("ul");$(this).closest("li").remove();var a=!1;void 0!==i.attr("id")&&(a=i.attr("id").toString()===t),i.children().length||a||(i.prev("div").children(".sortableListsOpener").first().remove(),i.remove()),MenuEditor.updateButtons(n)}}),$(document).on("click",".btnEdit",function(t){t.preventDefault(),function(t){var e=t.data();$.each(e,function(t,e){r.find("[name="+t+"]").val(e)}),r.find(".item-menu").first().focus(),e.hasOwnProperty("icon")?c.iconpicker("setIcon",e.icon):c.iconpicker("setIcon","empty");o.removeAttr("disabled")}(a=$(this).closest("li"))}),n.on("click",".btnUp",function(t){t.preventDefault();var e=$(this).closest("li");e.prev("li").before(e),MenuEditor.updateButtons(n)}),n.on("click",".btnDown",function(t){t.preventDefault();var e=$(this).closest("li");e.next("li").after(e),MenuEditor.updateButtons(n)}),n.on("click",".btnOut",function(t){t.preventDefault();var e=$(this).closest("ul"),s=$(this).closest("li");s.closest("ul").closest("li").after(s),e.children().length<=0&&(e.prev("div").children(".sortableListsOpener").first().remove(),e.remove()),MenuEditor.updateButtons(n),n.updateLevels()}),n.on("click",".btnIn",function(t){t.preventDefault();var e=$(this).closest("li"),s=e.prev("li");if(!m(e,s))return!1;if(s.length>0)if((i=s.children("ul")).length>0)i.append(e);else{var i=$("<ul>").addClass("pl-0").css("padding-top","10px");s.append(i),i.append(e),s.addClass("sortableListsOpen"),b(s)}MenuEditor.updateButtons(n),n.updateLevels()}),this.setForm=function(t){r=t},this.getForm=function(){return r},this.setUpdateButton=function(t){(o=t).attr("disabled",!0),a=null},this.getUpdateButton=function(){return o},this.getCurrentItem=function(){return a},this.update=function(){var t=this.getCurrentItem();if(null!==t){var e=t.data("icon");r.find(".item-menu").each(function(){t.data($(this).attr("name"),$(this).val())}),t.children().children("i").removeClass(e).addClass(t.data("icon")),t.find("span.txt").first().text(t.data("text")),h()}},this.add=function(){var t={};r.find(".item-menu").each(function(){t[$(this).attr("name")]=$(this).val()});var e=v(),s=$("<span>").addClass("txt").text(t.text),i=$("<i>").addClass(t.icon),a=$("<div>").css({overflow:"auto"}).append(i).append("&nbsp;").append(s).append(e),l=$("<li>").data(t);l.addClass("list-group-item pr-0").append(a),n.append(l),MenuEditor.updateButtons(n),a.each(function(){u.observe(this,p)}),h()},this.getJsonString=function(){var t=n.sortableListsToJson();return JSON.stringify(t)},this.getString=function(){return n.sortableListsToString()},this.getArray=function(){return n.sortableListsToArray()},this.getHierarchy=function(){return n.sortableListsToHierarchy()},this.setData=function(t){var e=Array.isArray(t)?t:function(t){try{var e=JSON.parse(t)}catch(t){return console.log("The string is not a json valid."),null}return e}(t);if(null!==e){n.empty();var a=function t(e,s){var a=void 0===s?0:s,l=0===a?n:$("<ul>").addClass("pl-0").css("padding-top","10px").data("level",a);return $.each(e,function(e,s){var r=void 0!==s.children&&$.isArray(s.children),o={text:"",href:"",icon:"empty",target:"_self",title:""},d=$.extend({},s);r&&delete d.children,$.extend(o,d);var c=$("<li>").addClass("list-group-item pr-0");c.data(o);var h=$("<div>").css("overflow","auto"),f=$("<i>").addClass(s.icon),b=$("<span>").addClass("txt").append(s.text).css("margin-right","5px"),m=v();if(h.append(f).append("&nbsp;").append(b).append(m),c.append(h),r&&c.append(t(s.children,a+1)),l.append(c),h.each(function(){u.observe(this,p)}),void 0!==s.value&&c.data("value",s.value),s.id){var g,C=n.attr("id")+"_li_"+s.id,x=!$("#"+C).length&&!l.find("#"+C).length;if(x)g=C;else{void 0===i[C]&&(i[C]=0);do{g=C+"_"+ ++i[C],x=!$("#"+g).length&&!l.find("#"+g).length}while(!x)}c.attr("id",g)}}),l}(e);l?n.find("li").each(function(){var t=$(this);t.children("ul").length&&b(t)}):(a.sortableLists(s.listOptions),l=!0),MenuEditor.updateButtons(n)}}}!function(t){t.fn.iconOpen=function(t){this.removeClass("sortableListsClosed").addClass("sortableListsOpen"),this.children("ul").css("display","block");var e=this.children("div").children(".sortableListsOpener").first();"html"===t.opener.as?e.html(t.opener.close):"class"===t.opener.as&&e.addClass(t.opener.close).removeClass(t.opener.open)},t.fn.iconClose=function(t){this.removeClass("sortableListsOpen").addClass("sortableListsClosed"),this.children("ul").css("display","none");var e=this.children("div").children(".sortableListsOpener").first();"html"===t.opener.as?e.html(t.opener.open):"class"===t.opener.as&&e.addClass(t.opener.open).removeClass(t.opener.close)},t.fn.sortableListsToJson=function(){var e=[];return t(this).children("li").each(function(){var n=t(this),s=n.data();e.push(s);var i=n.children("ul,ol").sortableListsToJson();i.length>0?s.children=i:delete s.children}),e},t.fn.updateLevels=function(e){var n=void 0===e?0:e;t(this).children("li").each(function(){var e=t(this).children("ul");e.length>0&&(e.data("level",n+1),e.updateLevels(n+1))})},t.fn.updateButtons=function(e){var n=void 0===e?0:e,s=["Up","In"],i=["Down"];0===n&&(s.push("Out"),i.push("Out"),t(this).children("li").hideButtons(["Out"])),t(this).children("li").each(function(){var e=t(this).children("ul");e.length>0&&e.updateButtons(n+1)}),t(this).children("li:first").hideButtons(s),t(this).children("li:last").hideButtons(i)},t.fn.hideButtons=function(e){for(var n=0;n<e.length;n++)t(this).find(".btn-group:first").children(".btn"+e[n]).hide()}}(jQuery),MenuEditor.updateButtons=function(t){t.find(".btnMove").show(),t.updateButtons()};