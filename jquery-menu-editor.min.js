function MenuEditor(t,e){var n=null,s=$("#"+t).data("level","0"),i={labelEdit:'<i class="fas fa-edit clickable"></i>',labelRemove:'<i class="fas fa-trash-alt clickable"></i>',textConfirmDelete:"This item will be deleted. Are you sure?",useModalConfirmation:!1,modalTitleText:"Confirm Deletion",modalCloseLabel:"Close",modalCancelButtonText:"Cancel",modalDeleteButtonText:'<i class="fas fa-trash-alt clickable"></i>&nbsp;Delete',iconPicker:{cols:4,rows:4,footer:!1,iconset:"fontawesome5"},maxLevel:-1,listOptions:{hintCss:{border:"1px dashed #13981D"},opener:{as:"html",close:'<i class="fas fa-minus"></i>',open:'<i class="fas fa-plus"></i>',openerCss:{"margin-right":"10px",float:"none"},openerClass:"btn btn-success btn-sm"},placeholderCss:{"background-color":"gray"},ignoreClass:"clickable",listsClass:"pl-0",listsCss:{"padding-top":"10px"},complete:function(t){return MenuEditor.updateButtons(s),s.updateLevels(0),!0},isAllowed:function(t,e,n){return g(t,n)}}};$.extend(!0,i,e);var a={},l=null,o=!0,r=null,d=null,c=i.iconPicker,u=(e=i.listOptions,$("#"+t+"_icon").iconpicker(c));s.sortableLists(i.listOptions),MutationObserver=window.MutationObserver||window.WebKitMutationObserver;var p=new MutationObserver(function(t){$.each(t,function(t,e){if(1==e.addedNodes.length){var n=$(e.target),s=$(e.addedNodes);s.hasClass("sortableListsOpener")&&!s.is(":first-child")&&n.prepend(s)}})}),h={subtree:!1,attributes:!1,childList:!0};function f(e){var n=e.closest("ul");e.closest("li").remove();var i=!1;void 0!==n.attr("id")&&(i=n.attr("id").toString()===t),n.children().length||i||(n.prev("div").children(".sortableListsOpener").first().remove(),n.remove()),MenuEditor.updateButtons(s)}function v(){r[0].reset(),(u=u.iconpicker(c)).iconpicker("setIcon","empty"),d.attr("disabled",!0),l=null}function b(t){return $("<a>").addClass(t.classCss).addClass("clickable").attr("href","#").html(t.text)}function m(){var t=$("<div>").addClass("btn-group float-right"),e=b({classCss:"btn btn-primary btn-sm btnEdit",text:i.labelEdit}),s=b({classCss:"btn btn-danger btn-sm btnRemove",text:i.labelRemove});i.useModalConfirmation&&(s.attr("data-toggle","modal"),s.attr("data-target","#"+n.attr("id")));var a=b({classCss:"btn btn-secondary btn-sm btnUp btnMove",text:'<i class="fas fa-angle-up clickable"></i>'}),l=b({classCss:"btn btn-secondary btn-sm btnDown btnMove",text:'<i class="fas fa-angle-down clickable"></i>'}),o=b({classCss:"btn btn-secondary btn-sm btnOut btnMove",text:'<i class="fas fa-level-down-alt clickable"></i>'}),r=b({classCss:"btn btn-secondary btn-sm btnIn btnMove",text:'<i class="fas fa-level-up-alt clickable"></i>'});return t.append(a).append(l).append(r).append(o).append(e).append(s),t}function C(t){$("<span>").addClass("sortableListsOpener "+e.opener.openerClass).css(e.opener.openerCss).on("mousedown touchstart",function(t){var n=$(this).closest("li");return n.hasClass("sortableListsClosed")?n.iconOpen(e):n.iconClose(e),!1}).prependTo(t.children("div").first()),t.hasClass("sortableListsOpen")?t.iconOpen(e):t.iconClose(e)}function g(t,e){if(i.maxLevel<0)return!0;var n=0,s=t.find("ul").length;return n=0==e.length?0:parseInt(e.parent().data("level"))+1,console.log(n+s),n+s<=i.maxLevel}u.on("change",function(t){r.find("[name=icon]").val(t.icon)}),s.on("click",".btnRemove",function(t){t.preventDefault(),!i.useModalConfirmation&&confirm(i.textConfirmDelete)&&f($(this))}),s.on("click",".btnEdit",function(t){t.preventDefault(),function(t){var e=t.data();$.each(e,function(t,e){r.find("[name="+t+"]").val(e)}),r.find(".item-menu").first().focus(),e.hasOwnProperty("icon")?u.iconpicker("setIcon",e.icon):u.iconpicker("setIcon","empty");d.removeAttr("disabled")}(l=$(this).closest("li"))}),s.on("click",".btnUp",function(t){t.preventDefault();var e=$(this).closest("li");e.prev("li").before(e),MenuEditor.updateButtons(s)}),s.on("click",".btnDown",function(t){t.preventDefault();var e=$(this).closest("li");e.next("li").after(e),MenuEditor.updateButtons(s)}),s.on("click",".btnOut",function(t){t.preventDefault();var e=$(this).closest("ul"),n=$(this).closest("li");n.closest("ul").closest("li").after(n),e.children().length<=0&&(e.prev("div").children(".sortableListsOpener").first().remove(),e.remove()),MenuEditor.updateButtons(s),s.updateLevels()}),s.on("click",".btnIn",function(t){t.preventDefault();var e=$(this).closest("li"),n=e.prev("li");if(!g(e,n))return!1;if(n.length>0)if((i=n.children("ul")).length>0)i.append(e);else{var i=$("<ul>").addClass("pl-0").css("padding-top","10px");n.append(i),i.append(e),n.addClass("sortableListsOpen"),C(n)}MenuEditor.updateButtons(s),s.updateLevels()}),this.setForm=function(t){r=t},this.getForm=function(){return r},this.setUpdateButton=function(t){(d=t).attr("disabled",!0),l=null},this.getUpdateButton=function(){return d},this.getCurrentItem=function(){return l},this.update=function(){var t=this.getCurrentItem();if(null!==t){var e=t.data("icon");r.find(".item-menu").each(function(){t.data($(this).attr("name"),$(this).val())}),t.children().children("i").removeClass(e).addClass(t.data("icon")),t.find("span.txt").first().text(t.data("text")),v()}},this.add=function(){var t={};r.find(".item-menu").each(function(){t[$(this).attr("name")]=$(this).val()});var e=m(),n=$("<span>").addClass("txt").text(t.text),i=$("<i>").addClass(t.icon),a=$("<div>").css({overflow:"auto"}).append(i).append("&nbsp;").append(n).append(e),l=$("<li>").data(t);l.addClass("list-group-item pr-0").append(a),s.append(l),MenuEditor.updateButtons(s),a.each(function(){p.observe(this,h)}),v()},this.getJson=function(){return s.menuEditorToJson()},this.getJsonString=function(){var t=s.menuEditorToJson();return JSON.stringify(t)},this.getArray=function(){return s.menuEditorToArray()},this.getArrayString=function(){var t=s.menuEditorToArray();return JSON.stringify(t)},this.setData=function(t){var e=Array.isArray(t)?t:function(t){try{var e=JSON.parse(t)}catch(t){return console.log("The string is not a json valid."),null}return e}(t);if(null!==e){s.empty(),i.useModalConfirmation&&(n=function(){var t=s.attr("id")+"_modal",e=$('<div class="modal fade" tabindex="-1" role="dialog" aria-labelledby="'+t+'_label" aria-hidden="true"><div class="modal-dialog" role="document"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="'+t+'_label">'+i.modalTitleText+'</h5><button type="button" class="close" data-dismiss="modal" aria-label="'+i.modalCloseLabel+'"><span aria-hidden="true">&times;</span></button></div><div class="modal-body">'+i.textConfirmDelete+'</div><div class="modal-footer"><button type="button" class="btn btn-secondary" data-dismiss="modal">'+i.modalCancelButtonText+'</button><button type="button" class="btn btn-danger btn-delete">'+i.modalDeleteButtonText+"</button></div></div></div></div>").attr("id",t).on("show.bs.modal",function(t){var e=$(t.relatedTarget);$(this).find(".btn-delete").off("click").on("click",function(){f(e),$(this).closest(".modal").modal("hide")})});return $("body").append(e),e}());var l=function t(e,n){var i=void 0===n?0:n,l=0===i?s:$("<ul>").addClass("pl-0").css("padding-top","10px").data("level",i);return $.each(e,function(e,n){var o=void 0!==n.id,r=void 0!==n.children&&$.isArray(n.children),d={text:"",href:"",icon:"empty",target:"_self",title:""},c=$.extend({},n);r&&delete c.children,$.extend(d,c);var u=$("<li>").addClass("list-group-item pr-0");u.data(d);var f=$("<div>").css("overflow","auto"),v=$("<i>").addClass(n.icon),b=$("<span>").addClass("txt").append(n.text).css("margin-right","5px"),C=m();if(f.append(v).append("&nbsp;").append(b).append(C),u.append(f),r&&u.append(t(n.children,i+1)),l.append(u),f.each(function(){p.observe(this,h)}),o){var g,x=s.attr("id")+"_li_"+n.id,y=!$("#"+x).length&&!l.find("#"+x).length;if(y)g=x;else{void 0===a[x]&&(a[x]=0);do{g=x+"_"+ ++a[x],y=!$("#"+g).length&&!l.find("#"+g).length}while(!y)}u.attr("id",g)}}),l}(e);o?s.find("li").each(function(){var t=$(this);t.children("ul").length&&C(t)}):(l.sortableLists(i.listOptions),o=!0),MenuEditor.updateButtons(s)}}}!function(t){t.fn.iconOpen=function(t){this.removeClass("sortableListsClosed").addClass("sortableListsOpen"),this.children("ul").css("display","block");var e=this.children("div").children(".sortableListsOpener").first();"html"===t.opener.as?e.html(t.opener.close):"class"===t.opener.as&&e.addClass(t.opener.close).removeClass(t.opener.open)},t.fn.iconClose=function(t){this.removeClass("sortableListsOpen").addClass("sortableListsClosed"),this.children("ul").css("display","none");var e=this.children("div").children(".sortableListsOpener").first();"html"===t.opener.as?e.html(t.opener.open):"class"===t.opener.as&&e.addClass(t.opener.open).removeClass(t.opener.close)},t.fn.menuEditorToJson=function(){var e=[];return t(this).children("li").each(function(){var n=t(this),s=t.extend(!0,{},n.data());e.push(s);var i=n.children("ul,ol").menuEditorToJson();i.length>0?s.children=i:delete s.children}),e},t.fn.menuEditorToArray=function(e,n){return e=e||[],t(this).children("li").each(function(){var s=t(this),i=t.extend(!0,{parentId:n},s.data());e.push(i);s.children("ul,ol").menuEditorToArray(e,i.id);delete i.children}),e},t.fn.updateLevels=function(e){var n=void 0===e?0:e;t(this).children("li").each(function(){var e=t(this).children("ul");e.length>0&&(e.data("level",n+1),e.updateLevels(n+1))})},t.fn.updateButtons=function(e){var n=void 0===e?0:e,s=["Up","In"],i=["Down"];0===n&&(s.push("Out"),i.push("Out"),t(this).children("li").hideButtons(["Out"])),t(this).children("li").each(function(){var e=t(this).children("ul");e.length>0&&e.updateButtons(n+1)}),t(this).children("li:first").hideButtons(s),t(this).children("li:last").hideButtons(i)},t.fn.hideButtons=function(e){for(var n=0;n<e.length;n++)t(this).find(".btn-group:first").children(".btn"+e[n]).hide()}}(jQuery),MenuEditor.updateButtons=function(t){t.find(".btnMove").show(),t.updateButtons()};