function MenuEditor(t,e){var n=null,i=$("#"+t).data("level","0"),s={labelEdit:'<i class="fas fa-edit clickable"></i>',labelRemove:'<i class="fas fa-trash-alt clickable"></i>',labelCancelDeletion:"Cancel",labelConfirmDeletion:'<i class="fas fa-trash-alt clickable"></i>&nbsp;Yes, delete it',textConfirmDeletion:"This item will be deleted. Are you sure?",useModalConfirmation:!1,iconPicker:{cols:4,rows:4,footer:!1,iconset:"fontawesome5"},maxLevel:-1,listOptions:{hintCss:{border:"1px dashed #13981D"},opener:{as:"html",close:'<i class="fas fa-minus"></i>',open:'<i class="fas fa-plus"></i>',openerCss:{"margin-right":"10px",float:"none"},openerClass:"btn btn-success btn-sm"},placeholderCss:{"background-color":"gray"},ignoreClass:"clickable",listsClass:"pl-0",listsCss:{"padding-top":"10px"},complete:function(t){return MenuEditor.updateButtons(i),i.updateLevels(0),!0},isAllowed:function(t,e,n){return x(t,n)}}};$.extend(!0,s,e);var a={},o=null,l=!0,r=null,d=null,c=s.iconPicker,u=(e=s.listOptions,$("#"+t+"_icon").iconpicker(c));i.sortableLists(s.listOptions),MutationObserver=window.MutationObserver||window.WebKitMutationObserver;var p=new MutationObserver(function(t){$.each(t,function(t,e){if(1==e.addedNodes.length){var n=$(e.target),i=$(e.addedNodes);i.hasClass("sortableListsOpener")&&!i.is(":first-child")&&n.prepend(i)}})}),h={subtree:!1,attributes:!1,childList:!0};function f(e){var n=e.closest("ul");e.closest("li").remove();var s=!1;void 0!==n.attr("id")&&(s=n.attr("id").toString()===t),n.children().length||s||(n.prev("div").children(".sortableListsOpener").first().remove(),n.remove()),MenuEditor.updateButtons(i)}function v(){r[0].reset(),(u=u.iconpicker(c)).iconpicker("setIcon","empty"),d.attr("disabled",!0),o=null}function b(t){return $("<a>").addClass(t.classCss).addClass("clickable").attr("href","#").html(t.text)}function m(){var t=$("<div>").addClass("btn-group float-right"),e=b({classCss:"btn btn-primary btn-sm btnEdit",text:s.labelEdit}),i=b({classCss:"btn btn-danger btn-sm btnRemove",text:s.labelRemove});s.useModalConfirmation&&i.attr({"data-toggle":"modal","data-target":"#"+n.attr("id")});var a=b({classCss:"btn btn-secondary btn-sm btnUp btnMove",text:'<i class="fas fa-angle-up clickable"></i>'}),o=b({classCss:"btn btn-secondary btn-sm btnDown btnMove",text:'<i class="fas fa-angle-down clickable"></i>'}),l=b({classCss:"btn btn-secondary btn-sm btnOut btnMove",text:'<i class="fas fa-level-down-alt clickable"></i>'}),r=b({classCss:"btn btn-secondary btn-sm btnIn btnMove",text:'<i class="fas fa-level-up-alt clickable"></i>'});return t.append(a).append(o).append(r).append(l).append(e).append(i),t}function C(t,e){var n,i=!$("#"+t).length&&!$(e).find("#"+t).length;if(i)n=t;else{void 0===a[t]&&(a[t]=0);do{n=t+"_"+ ++a[t],i=!$("#"+n).length&&!$(e).find("#"+n).length}while(!i)}return n}function g(t){$("<span>").addClass("sortableListsOpener "+e.opener.openerClass).css(e.opener.openerCss).on("mousedown touchstart",function(t){var n=$(this).closest("li");return n.hasClass("sortableListsClosed")?n.iconOpen(e):n.iconClose(e),!1}).prependTo(t.children("div").first()),t.hasClass("sortableListsOpen")?t.iconOpen(e):t.iconClose(e)}function x(t,e){if(s.maxLevel<0)return!0;var n=0,i=t.find("ul").length;return n=0==e.length?0:parseInt(e.parent().data("level"))+1,console.log(n+i),n+i<=s.maxLevel}u.on("change",function(t){r.find("[name=icon]").val(t.icon)}),i.on("click",".btnRemove",function(t){t.preventDefault(),!s.useModalConfirmation&&confirm(s.textConfirmDeletion)&&f($(this))}),i.on("click",".btnEdit",function(t){t.preventDefault(),function(t){var e=t.data();$.each(e,function(t,e){r.find("[name="+t+"]").val(e)}),r.find(".item-menu").first().focus(),e.hasOwnProperty("icon")?u.iconpicker("setIcon",e.icon):u.iconpicker("setIcon","empty");d.removeAttr("disabled")}(o=$(this).closest("li"))}),i.on("click",".btnUp",function(t){t.preventDefault();var e=$(this).closest("li");e.prev("li").before(e),MenuEditor.updateButtons(i)}),i.on("click",".btnDown",function(t){t.preventDefault();var e=$(this).closest("li");e.next("li").after(e),MenuEditor.updateButtons(i)}),i.on("click",".btnOut",function(t){t.preventDefault();var e=$(this).closest("ul"),n=$(this).closest("li");n.closest("ul").closest("li").after(n),e.children().length<=0&&(e.prev("div").children(".sortableListsOpener").first().remove(),e.remove()),MenuEditor.updateButtons(i),i.updateLevels()}),i.on("click",".btnIn",function(t){t.preventDefault();var e=$(this).closest("li"),n=e.prev("li");if(!x(e,n))return!1;if(n.length>0)if((s=n.children("ul")).length>0)s.append(e);else{var s=$("<ul>").addClass("pl-0").css("padding-top","10px");n.append(s),s.append(e),n.addClass("sortableListsOpen"),g(n)}MenuEditor.updateButtons(i),i.updateLevels()}),this.setForm=function(t){r=t},this.getForm=function(){return r},this.setUpdateButton=function(t){(d=t).attr("disabled",!0),o=null},this.getUpdateButton=function(){return d},this.getCurrentItem=function(){return o},this.update=function(){var t=this.getCurrentItem();if(null!==t){var e=t.data("icon");r.find(".item-menu").each(function(){t.data($(this).attr("name"),$(this).val())}),t.children().children("i").removeClass(e).addClass(t.data("icon")),t.find("span.txt").first().text(t.data("text")),v()}},this.add=function(){var t={};r.find(".item-menu").each(function(){t[$(this).attr("name")]=$(this).val()});var e=m(),n=$("<span>").addClass("txt").text(t.text),s=$("<i>").addClass(t.icon),a=$("<div>").css({overflow:"auto"}).append(s).append("&nbsp;").append(n).append(e),o=$("<li>").data(t);o.addClass("list-group-item pr-0").append(a),i.append(o),MenuEditor.updateButtons(i),a.each(function(){p.observe(this,h)}),v()},this.getJson=function(){return i.menuEditorToJson()},this.getJsonString=function(){var t=i.menuEditorToJson();return JSON.stringify(t)},this.getArray=function(){return i.menuEditorToArray()},this.getArrayString=function(){var t=i.menuEditorToArray();return JSON.stringify(t)},this.setData=function(t){var e=Array.isArray(t)?t:function(t){try{var e=JSON.parse(t)}catch(t){return console.log("The string is not a json valid."),null}return e}(t);if(null!==e){i.empty(),s.useModalConfirmation&&(n=function(){var t=C(i.attr("id")+"_modal"),e=C(i.attr("id")+"_modal_title"),n=$('<div class="modal fade" tabindex="-1" role="dialog" aria-hidden="true"><div class="modal-dialog" role="document"><div class="modal-content"><div class="modal-header border-bottom-0"><h5 class="modal-title">'+s.textConfirmDeletion+'</h5></div><div class="modal-footer border-top-0"><button type="button" class="btn btn-secondary" data-dismiss="modal">'+s.labelCancelDeletion+'</button><button type="button" class="btn btn-danger btnConfirmRemoval">'+s.labelConfirmDeletion+"</button></div></div></div></div>").attr("id",t).attr("aria-labelledby",e).on("show.bs.modal",function(t){var e=$(t.relatedTarget);$(this).find(".btnConfirmRemoval").data("deleteButton",e)});return n.find(".modal-title").attr("id",e),n.find(".btnConfirmRemoval").on("click",function(){f($(this).data("deleteButton")),$(this).closest(".modal").modal("hide")}),$("body").append(n),n}());var a=function t(e,n){var s=void 0===n?0:n,a=0===s?i:$("<ul>").addClass("pl-0").css("padding-top","10px").data("level",s);return $.each(e,function(e,n){var o=void 0!==n.id,l=void 0!==n.children&&$.isArray(n.children),r={text:"",href:"",icon:"empty",target:"_self",title:""},d=$.extend({},n);l&&delete d.children,$.extend(r,d);var c=$("<li>").addClass("list-group-item pr-0");c.data(r);var u=$("<div>").css("overflow","auto"),f=$("<i>").addClass(n.icon),v=$("<span>").addClass("txt").append(n.text).css("margin-right","5px"),b=m();if(u.append(f).append("&nbsp;").append(v).append(b),c.append(u),l&&c.append(t(n.children,s+1)),a.append(c),u.each(function(){p.observe(this,h)}),o){var g=C(i.attr("id")+"_li_"+n.id,a);c.attr("id",g)}}),a}(e);l?i.find("li").each(function(){var t=$(this);t.children("ul").length&&g(t)}):(a.sortableLists(s.listOptions),l=!0),MenuEditor.updateButtons(i)}}}!function(t){t.fn.iconOpen=function(t){this.removeClass("sortableListsClosed").addClass("sortableListsOpen"),this.children("ul").css("display","block");var e=this.children("div").children(".sortableListsOpener").first();"html"===t.opener.as?e.html(t.opener.close):"class"===t.opener.as&&e.addClass(t.opener.close).removeClass(t.opener.open)},t.fn.iconClose=function(t){this.removeClass("sortableListsOpen").addClass("sortableListsClosed"),this.children("ul").css("display","none");var e=this.children("div").children(".sortableListsOpener").first();"html"===t.opener.as?e.html(t.opener.open):"class"===t.opener.as&&e.addClass(t.opener.open).removeClass(t.opener.close)},t.fn.menuEditorToJson=function(){var e=[];return t(this).children("li").each(function(){var n=t(this),i=t.extend(!0,{},n.data());e.push(i);var s=n.children("ul,ol").menuEditorToJson();s.length>0?i.children=s:delete i.children}),e},t.fn.menuEditorToArray=function(e,n){return e=e||[],t(this).children("li").each(function(){var i=t(this),s=t.extend(!0,{parentId:n},i.data());e.push(s);i.children("ul,ol").menuEditorToArray(e,s.id);delete s.children}),e},t.fn.updateLevels=function(e){var n=void 0===e?0:e;t(this).children("li").each(function(){var e=t(this).children("ul");e.length>0&&(e.data("level",n+1),e.updateLevels(n+1))})},t.fn.updateButtons=function(e){var n=void 0===e?0:e,i=["Up","In"],s=["Down"];0===n&&(i.push("Out"),s.push("Out"),t(this).children("li").hideButtons(["Out"])),t(this).children("li").each(function(){var e=t(this).children("ul");e.length>0&&e.updateButtons(n+1)}),t(this).children("li:first").hideButtons(i),t(this).children("li:last").hideButtons(s)},t.fn.hideButtons=function(e){for(var n=0;n<e.length;n++)t(this).find(".btn-group:first").children(".btn"+e[n]).hide()}}(jQuery),MenuEditor.updateButtons=function(t){t.find(".btnMove").show(),t.updateButtons()};